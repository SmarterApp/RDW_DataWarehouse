###
# app configuration
# http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/environment.html
###

common:
  '[app:main]':
    use: egg:smarter
    disable_stack_trace: false
    smarter.PATH: /usr/local/bin
    batch.user.session.timeout: 300000
    pyramid:
      reload_templates: true
      debug_all: false
      debug_authorization: false
      debug_notfound: false
      debug_routematch: false
      default_locale_name: en
      includes: pyramid_tm pyramid_exclog pyramid_beaker

    # pyramid_beaker configuration
    cache:
      regions: public.data, public.filtered_data, public.shortlived, session
      type: ext:memcached
      expire: 3600 # one hour
      public.data.expire: 31556940 # year
      public.filtered_data.expire: 15552000 # six month
      public.shortlived.expire: 7776000 # three months
      session.expire: 1200 # 20 minutes
      lock_dir: /tmp/memcache

    # Database
    edware:
      db:
        echo: False
    trigger:
      recache:
        enable: False
        filter.file:  /opt/edware/conf/comparing_populations_precache_filters.json
        schedule:
          cron:
            day: '*/1'
      pdf:
        enable: False
        schedule:
          cron:
            day: '*/1'

    # Authentication
    auth:
      state:
        secret: long_secret_for_redirects1111234
      policy:
        secret: edware_secret
        cookie_name: edware
        hashalg: sha512
        http_only: true
        # Represents the lifetime of the cookie itself, if it's not set, it's session based cookie
        #max_age: 2400
        # Maximum number of seconds which a newly issued ticket will be considered valid
        timeout: 1200
        # Session expiration time
      session:
        timeout: 1200
      idp:
        metadata: ../../resource/idp_metadata.xml
      saml:
        identity_parser: smarter_common.security.sbac_identity_parser.SbacIdentityParser

    # Static cache max age
    smarter.resources.static.max_age: 3600
    smarter.reports.year_back: 5
    # We support dev, prod, and test (env that runs FT) modes
    mode: dev
    # Run npm update (dev mode only)
    run.npm.update: true
    # Timeout for pdf generation process
    pdf:
      # expected pdf file size in bytes used to validate that pdf was generated without errors
      minimum_file_size: 56000
      # number of retries allowed after the first failure
      retries_allowed: 3
      # delay in retry in seconds
      retry_delay: 0
      generate_timeout: 30
      report_base_dir: /tmp/pdf
      celery_timeout: 30
      # Don't regenerate if pdf is in file system
      always_generate: False
      base.url: http://localhost:6543/assets/html/
      batch.job.queue: batch_pdf_gen
      single_generate.queue: single_pdf_gen
      health_check.job.queue: health_check
      merge:
         pdfunite_timeout: 3600
    # Used for tenancy
    ldap.base.dn: ou=environment,dc=edwdc,dc=net
    # Use context security
    disable.context.security: False
    services.celery:
      CELERY_IMPORTS: ('services.tasks.pdf',)
      CELERY_RESULT_BACKEND: amqp
      CELERY_TASK_RESULT_EXPIRES: 18000 # 5 hours
      CELERYD_CONCURRENCY: 20
      CELERY_DEFAULT_QUEUE: batch_pdf_gen
      CELERY_DEFAULT_ROUTING_KEY: batch_pdf_gen
      CELERY_DEFAULT_EXCHANGE_TYPE: direct
      CELERY_QUEUES:
        -   name: celery
            exchange: direct
            key: celery
        -   name: batch_pdf_gen
            exchange: direct
            key: batch_pdf_gen
        -   name: batch_worker
            exchange: direct
            key: batch_worker
        -   name: health_check
            exchange: direct
            key: health_check
        -   name: single_pdf_gen
            exchange: direct
            key: single_pdf_gen
    extract:
      celery_timeout: 30
      retry_delay: 60
      retries_allowed: 1
      item_level_base_dir: /opt/edware/item_level
      raw_data_base_dir: /opt/edware/raw_data
      # if extract size is estimated beyond this multiple extracts file size will be created
      partial_file:
        size:
          soft_limit: 30000000
          average.csv: 30000
          average.xml: 300000
      work_zone_base_dir: /tmp
      gpg.homedir: ~/.gnupg
      gpg.public_key.cat: kswimberly@amplify.com
      gpg.public_key.fish: kswimberly@amplify.com
      gpg.keyserver: hkp://edwappsrv3.poc.dum.edwdc.net
      sftp.route.base_dir: route
      cleanup.schedule.cron.day: last
      available_grades: 3,4,5,6,7,8,11
      job.queue.async: extract
      job.queue.sync: extract_sync
      job.queue.archive: extract_archive
      celery:
        CELERY_IMPORTS: ('edextract.tasks.extract',)
        CELERY_RESULT_BACKEND: amqp
        CELERY_TASK_RESULT_EXPIRES: 18000 # 5 hours
        CELERYD_CONCURRENCY: 20
        CELERY_DEFAULT_QUEUE: extract
        CELERY_DEFAULT_ROUTING_KEY: extract
        CELERY_DEFAULT_EXCHANGE_TYPE: direct
        CELERY_QUEUES:
          -   name: celery
              exchange: direct
              key: celery
          -   name: extract
              exchange: direct
              key: extract
          -   name: extract_sync
              exchange: direct
              key: extract_sync
    smarter_score_batcher:
      base_dir:
        xml: /opt/edware/raw_data
        csv: /opt/edware/item_level
      celery_timeout: 30
      sync_queue: smarter_score_batcher_sync
      celery:
        CELERY_IMPORTS: ('smarter_score_batcher.tasks.remote_writer',)
        CELERY_RESULT_BACKEND: amqp
        CELERY_TASK_RESULT_EXPIRES: 18000 # 5 hours
        CELERYD_CONCURRENCY: 20
        CELERY_DEFAULT_QUEUE: smarter_score_batcher
        CELERY_DEFAULT_ROUTING_KEY: smarter_score_batcher
        CELERY_DEFAULT_EXCHANGE_TYPE: direct
      xsd:
        path: ../resources/sample_xsd.xsd
    sftp:
        home: /
        base_dir: /sftp/opt/edware/home
        arrivals_dir: arrivals
        file_patterns_to_watch:
            - '*.gpg'
            - '*.gpg.done'
        file_stat_watch_interval: 2
        file_stat_watch_period: 10
        file_system_scan_delay: 10
        sftp_departures_dir: departures
        sftp_filerouter_dir:
        user_home_base_dir: /opt/edware/home
        group: edwaredataadmin
        roles:
            - sftparrivals
            - sftpdepartures
            - filerouter
        user_path_sftparrivals_dir: file_drop
        user_path_sftpdepartures_dir: reports
        user_path_filerouter_dir: route
        remote:
            arrivals_path: /opt/edware/zones/landing/arrivals
            sftp_user: udl2
            private_key_file: /opt/edware/ssh/.ssh/id_rsa
    migrate:
      broadcast.queue: 'edmigrate_players'
      pgpool.hostname: 'dwrouter1.qa.dum.edwdc.net'
      iptables.mock: False
      iptables.chain: 'EDMIGRATE_PGSQL'
      iptables.command: '/sbin/iptables'
      iptables.sudo: '/usr/bin/sudo'
      timeout: 5
      celery:
        CELERY_IMPORTS: ('edmigrate.tasks.player')
        CELERY_RESULT_BACKEND: amqp
        CELERY_DEFAULT_QUEUE: celery
        CELERY_DEFAULT_ROUTING_KEY: default
        CELERY_DEFAULT_EXCHANGE_TYPE: direct
        CELERY_QUEUES:
          -   name: edmigrate_players
              exchange: fanout
              key: edmigrate_players
              durable: False
        CELERY_ROUTES:
          - edmigrate.tasks.player:
              queue: edmigrate_players
      replication_monitor:
        replication_lag_tolerance: 100
        apply_lag_tolerance: 100
        time_lag_tolerance: 100
        monitor_timeout: 28800
        admin:
          replication_lag_tolerance: 100
          apply_lag_tolerance: 100
          time_lag_tolerance: 100
          check_interval: 1800
      conductor:
        find_player.timeout: 5
        enable: True
        schedule:
          cron:
            day: '*/1'
    migrate_source:
      db:
        cat:
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
    migrate_dest:
      db:
        cat:
          schema_name: edware_prod
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
    sftp.jail.base_path: /sftp
    pickup:
      sftp.hostname: edwappsrv5.poc.dum.edwdc.net
      sftp.user: filerouter
      sftp.private_key_file: /var/lib/jenkins/.ssh/id_rsa
      gatekeeper.cat: kswimberly
      gatekeeper.dog: skong
      gatekeeper.fish: kswimberly
  '[server:main]':
    use: 'egg:waitress#main'
    host: 0.0.0.0
    port: 6543

  ###
  # logging configuration
  # http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/logging.html
  ###

  '[loggers]':
    keys: root, smarter, sqlalchemy, exc_logger, audit, edauth, security_event, edmigrate, edsftp, edudl2
  '[handlers]':
    keys: console, filelog, audit, security_event, mna_rest

  '[formatters]':
    keys: generic, json, mna

  '[logger_edauth]':
    level: DEBUG
    handlers: filelog
    qualname: edauth

  '[logger_root]':
    level: INFO
    handlers: filelog, console

  '[logger_smarter]':
    level: INFO
    handlers: filelog
    qualname: smarter

  '[logger_sqlalchemy]':
    level: WARN
    handlers: filelog
    qualname: sqlalchemy
    # "level = INFO" logs SQL queries.
    # "level = DEBUG" logs SQL queries and results.
    # "level = WARN" logs neither.  (Recommended for production systems.)

  '[logger_exc_logger]':
    level: ERROR
    handlers: filelog
    qualname: exc_logger

  '[logger_audit]':
    level: INFO
    handlers: audit
    qualname: audit
    # Important: this means it doesn't propagate to root logger
    propagate: 0

  '[logger_edmigrate]':
    level: INFO
    handlers: filelog
    qualname: edmigrate

  '[logger_edsftp]':
    level: INFO
    handlers: filelog
    qualname: edsftp

  '[logger_edudl2]':
    level: INFO
    handlers: filelog
    qualname: edudl2

  '[logger_security_event]':
    level: INFO
    handlers: security_event
    qualname: security_event
    # Important: this means it doesn't propagate to root logger
    propagate: 0

  '[handler_console]':
    class: StreamHandler
    args: (sys.stderr,)
    level: NOTSET
    formatter: generic

  '[handler_filelog]':
    class: logging.handlers.TimedRotatingFileHandler
    args: '(''/tmp/smarter.log'',''midnight'')'  # (path, when)
    level: INFO
    formatter: generic

  '[handler_audit]':
    class: logging.handlers.TimedRotatingFileHandler
    args: '(''/tmp/audit.log'',''midnight'')'   # (path, when)
    level: INFO
    formatter: json

  '[handler_security_event]':
    class: logging.handlers.TimedRotatingFileHandler
    args: '(''/tmp/security_event.log'',''midnight'')'   # (path, when)
    level: INFO
    formatter: json

  '[handler_mna_rest]':
    class: smarter_common.logging.mna.MNAHTTPHandler
    formatter: mna
    args: ('mna-dev.opentestsystem.org:8443', '/mna-rest/log', 'POST', 'True')
    level: DEBUG


  '[formatter_generic]':
    format: '%(asctime)s %(levelname)-5.5s [%(name)s][%(threadName)s] %(message)s'

  '[formatter_json]':
    class: edapi.logging.JsonDictLoggingFormatter
    format: '%(asctime)s %(message)s'

  '[formatter_mna]':
    class: smarter_common.logging.mna.MnALoggingFormatter
    format: '[%(name)s][%(threadName)s] %(message)s'

# End logging configuration

qa:
  '[app:main]':
    mode: prod
    smarter.PATH: /usr/local/bin:/opt/wkhtmltopdf/bin:/opt/pdfunite/bin/
    services.celery:
      BROKER_URL: amqp://edware:edware1234@dwqldr0.qa.dum.edwdc.net/services
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@dwqldr0.qa.dum.edwdc.net/edmigrate
    extract.work_zone_base_dir: /opt/edware/extraction
    extract.celery:
      BROKER_URL: amqp://edware:edware1234@dwqldr0.qa.dum.edwdc.net/edextract
    smarter_score_batcher.celery:
      BROKER_URL: amqp://edware:edware1234@dwqldr0.qa.dum.edwdc.net/smarter_score_batcher
    extract:
      gpg:
        homedir : /opt/edware/conf/gpg
        keyserver: hkp://rbtmqdw0.qa.dum.edwdc.net
    cache:
      public.shortlived.url: dwcache0.qa.dum.edwdc.net:11211
      public.data.url: dwcache0.qa.dum.edwdc.net:11211
      session.url: dwcache0.qa.dum.edwdc.net:11211
      public.filtered_data.url: dwcache0.qa.dum.edwdc.net:11211
    pdf:
      base.url: https://ha-int-pyweb0.qa.dum.edwdc.net/assets/html/
      report_base_dir: /opt/edware/pdf
      generate_timeout: 30
      health_check.job.queue: health_check
    pickup.sftp:
      hostname: lzsftpudl0.qa.dum.edwdc.net
      private_key_file: /opt/edware/ssh/.ssh/id_rsa
    sftp:
        file_stat_watch_interval: 5
        file_stat_watch_period: 30
        file_system_scan_delay: 60
        remote:
            landing_zone_hostname: rbtmqudl0.qa.dum.edwdc.net
    edware:
      db:
        cat:
          state_code: ES
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:edware2013@dwpool1.qa.dum.edwdc.net:6432/edware
    edware_stats:
      db:
        schema_name: edware_es_1_6
        url: postgresql+psycopg2://edware:edware2013@dbpgdw0.qa.dum.edwdc.net:5432/edware_stats
    edware_rep:
      db:
        schema_name: repmgr_edware_pg_cluster
        url: postgresql+psycopg2://edware:edware2013@dbpgdw0.qa.dum.edwdc.net:5432/edware
    migrate:
      pgpool.hostname: 'dwrouter1.qa.dum.edwdc.net'
      timeout: 6
    migrate_dest:
      db:
        cat:
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:edware2013@dbpgdw0.qa.dum.edwdc.net:5432/edware
        sc:
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:edware2013@dbpgdw0.qa.dum.edwdc.net:5432/edware
    migrate_source:
      db:
        cat:
          url: postgresql+psycopg2://edware:edware2013@dbpgudl0.qa.dum.edwdc.net:5432/edware
        sc:
          url: postgresql+psycopg2://edware:edware2013@dbpgudl0.qa.dum.edwdc.net:5432/edware
    auth:
      idp:
        metadata: /opt/edware/conf/idp_metadata.xml
      policy:
        secure: true
      skip.verify: False
      saml:
        issuer_name: https://ha-int-pyweb0.qa.dum.edwdc.net
        idp_server_login_url: https://auth1.qa.dum.edwdc.net/openam/SSORedirect/metaAlias/idp
        idp_server_logout_url: https://auth1.qa.dum.edwdc.net/openam/IDPSloRedirect/metaAlias/idp
        name_qualifier: https://auth1.qa.dum.edwdc.net/openam
    hpz:
      file_registration_url: https://hpzweb0.qa.dum.edwdc.net:8443/registration
      file_upload_base_url: https://hpzweb0.qa.dum.edwdc.net:8443/files
      ignore_certificate: True
  '[handlers]':
    keys: audit, syslog, security_event
  '[logger_root]':
    level: INFO
    handlers: syslog
  '[handler_syslog]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL1)'
    level: WARN
    formatter: generic
  '[handler_audit]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL0)'
    level: WARN
    formatter: json
  '[handler_security_event]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL2)'
    level: INFO
    formatter: json
  '[logger_smarter]':
    level: WARN
    handlers: syslog
    qualname: smarter
  '[logger_edauth]':
    level: WARN
    handlers: syslog
    qualname: edauth
  '[logger_sqlalchemy]':
    level: WARN
    handlers: syslog
    qualname: sqlalchemy
  '[logger_exc_logger]':
    level: ERROR
    handlers: syslog
    qualname: exc_logger
  '[logger_edmigrate]':
    level: WARN
    handlers: syslog
    qualname: edmigrate
  '[logger_edsftp]':
    level: WARN
    handlers: syslog
    qualname: edsftp
  '[logger_edudl2]':
    level: WARN
    handlers: syslog
    qualname: edudl2

qa.extract:
  '[app:main]':
    edware:
      db:
        cat:
          state_code: ES
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:edware2013@dwpool1.qa.dum.edwdc.net:6432/edware

qa.pdf_generator:
  '[app:main]':
    batch.user.session.timeout: 300000
    cache:
      session.expire: 1200 # 20 minutes

jenkins_qa:
  '[app:main]':
    mode: test
    edware:
      db:
        cat:
          state_code: CA
          schema_name: edware_sds_1_25
          url: postgresql+psycopg2://postgres:edware.qa.2013@dwpool0.qa.dum.edwdc.net:6432/edware
    edware_stats:
      db:
        schema_name: edware_sds_1_25
        url: postgresql+psycopg2://edware:edware2013@dwpool0.qa.dum.edwdc.net:6432/edware_stats
    services.celery:
        BROKER_URL: amqp://edware:edware1234@rbtmqdw0.qa.dum.edwdc.net/services
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@rbtmqdw0.qa.dum.edwdc.net/edmigrate
    extract.celery:
        BROKER_URL: amqp://edware:edware1234@rbtmqdw0.qa.dum.edwdc.net/edextract
    smarter_score_batcher.celery:
        BROKER_URL: amqp://edware:edware1234@rbtmqdw0.qa.dum.edwdc.net/smarter_score_batcher
    hpz:
        file_registration_url: http://localhost/registration
        file_upload_base_url: http://localhost/files

uat:
  '[app:main]':
    mode: prod
    smarter.PATH: /usr/local/bin:/opt/wkhtmltopdf/bin:/opt/pdfunite/bin/
    services.celery:
      BROKER_URL: amqp://edware:edware1234@rbtmqdw0.dmo.som.edwdc.net/services
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@rbtmqdw0.dmo.som.edwdc.net/edmigrate
    extract.celery:
      BROKER_URL: amqp://edware:edware1234@rbtmqdw0.dmo.som.edwdc.net/edextract
    smarter_score_batcher.celery:
      BROKER_URL: amqp://edware:edware1234@rbtmqdw0.dmo.som.edwdc.net/smarter_score_batcher
    extract:
      gpg:
        keyserver: hkp://celrydw1.dmo.som.edwdc.net
        homedir : /opt/edware/conf/gpg
        public_key.es: kswimberly@amplify.com
      work_zone_base_dir: /opt/edware/extraction
    cache:
      public.shortlived.url: dwcache0.dmo.som.edwdc.net:11211;dwcache1.dmo.som.edwdc.net:11211
      public.data.url: dwcache0.dmo.som.edwdc.net:11211;dwcache1.dmo.som.edwdc.net:11211
      session.url: dwcache0.dmo.som.edwdc.net:11211;dwcache1.dmo.som.edwdc.net:11211
      public.filtered_data.url: dwcache0.dmo.som.edwdc.net:11211;dwcache1.dmo.som.edwdc.net:11211
    pdf:
      base.url: https://beta.smarterbalancedreporting.org/assets/html/
      report_base_dir: /opt/edware/pdf
      generate_timeout: 30
      health_check.job.queue: health_check
    pickup:
      gatekeeper.es: kswimberly
      sftp:
        hostname: lzsftpudl0.dmo.som.edwdc.net
        private_key_file: /opt/edware/ssh/.ssh/id_rsa
    disable_stack_trace: true
    sftp:
        file_stat_watch_interval: 10
        file_stat_watch_period: 60
        file_system_scan_delay: 300
        remote:
            landing_zone_hostname: rbtmqudl0.dmo.som.edwdc.net
    edware:
      db:
        es:
          state_code: ES
          schema_name: edware_uat_1_1
          url: postgresql+psycopg2://edware:xON.yw27aw@dwpool0.dmo.som.edwdc.net:6432/edware
    edware_stats:
      db:
        schema_name: edware_uat_1_1
        url: postgresql+psycopg2://edware:xON.yw27aw@dbpgdw0.dmo.som.edwdc.net:5432/edware_stats
    edware_rep:
      db:
        schema_name: repmgr_edware_pg_cluster
        url: postgresql+psycopg2://edware:xON.yw27aw@dbpgdw0.dmo.som.edwdc.net:5432/edware
    migrate:
      pgpool.hostname: 'dwrouter0.dmo.som.edwdc.net'
      timeout: 6
    migrate_dest:
      db:
        cat:
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:xON.yw27aw@dbpgdw0.dmo.som.edwdc.net:5432/edware
        es:
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:xON.yw27aw@dbpgdw0.dmo.som.edwdc.net:5432/edware
        sc:
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:xON.yw27aw@dbpgdw0.dmo.som.edwdc.net:5432/edware
    migrate_source:
      db:
        es:
          url: postgresql+psycopg2://edware:xON.yw27aw@rbtmqudl0.dmo.som.edwdc.net:5432/edware
        sc:
          url: postgresql+psycopg2://edware:xON.yw27aw@rbtmqudl0.dmo.som.edwdc.net:5432/edware
    auth:
      idp:
        metadata: /opt/edware/conf/idp_metadata.xml
      policy:
        secure: true
      skip.verify: False
      saml:
        issuer_name: https://pyweb.dmo.som.edwdc.net
        idp_server_login_url: https://betaauth.smarterbalancedreporting.org/openam/SSORedirect/metaAlias/idp
        idp_server_logout_url: https://betaauth.smarterbalancedreporting.org/openam/IDPSloRedirect/metaAlias/idp
        name_qualifier: https://betaauth.smarterbalancedreporting.org/openam
    hpz:
        file_registration_url: https://hpzweb0.dmo.som.edwdc.net:8443/registration
        file_upload_base_url: https://hpzweb0.dmo.som.edwdc.net:8443/files
  '[handlers]':
    keys: audit, syslog, security_event
  '[logger_root]':
    level: INFO
    handlers: syslog
  '[handler_syslog]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL1)'
    level: WARN
    formatter: generic
  '[handler_audit]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL0)'
    level: WARN
    formatter: json
  '[handler_security_event]':
    class: logging.handlers.SysLogHandler
    args: '(''/dev/log'', handlers.SysLogHandler.LOG_LOCAL2)'
    level: INFO
    formatter: json
  '[logger_smarter]':
    level: WARN
    handlers: syslog
    qualname: smarter
  '[logger_edauth]':
    level: WARN
    handlers: syslog
    qualname: edauth
  '[logger_sqlalchemy]':
    level: WARN
    handlers: syslog
    qualname: sqlalchemy
  '[logger_exc_logger]':
    level: ERROR
    handlers: syslog
    qualname: exc_logger
  '[logger_edmigrate]':
    level: WARN
    handlers: syslog
    qualname: edmigrate
  '[logger_edsftp]':
    level: WARN
    handlers: syslog
    qualname: edsftp
  '[logger_edudl2]':
    level: WARN
    handlers: syslog
    qualname: edudl2

uat.extract:
  '[app:main]':
    edware:
      db:
        cat:
          state_code: ES
          schema_name: edware_es_1_6
          url: postgresql+psycopg2://edware:edware2013@dwpool1.qa.dum.edwdc.net:6432/edware

uat.pdf_generator:
  '[app:main]':
    batch.user.session.timeout: 300000
    cache:
      session.expire: 300000 # 20 minutes

localOpenAM:
  '[app:main]':
    edware:
      db:
        cat:
          state_code: NC
          schema_name: edware_sds_1_2
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware
          echo: False
    edware_stats:
      db:
        schema_name: edware_sds_1_2
        url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_stats
    auth:
      skip.verify: False
      saml:
        idp_server_login_url: http://local.slidev.org:8080/openam/SSORedirect/metaAlias/idp
        idp_server_logout_url: http://local.slidev.org:8080/openam/IDPSloRedirect/metaAlias/idp
        issuer_name: http://local.slidev.org:6543/sp.xml
        name_qualifier: http://local.slidev.org:8080/openam
    mode: dev
    hpz:
        file_registration_url: http://localhost/registration
        file_upload_base_url: http://localhost/files

development:
  '[app:main]':
    cache:
      regions: public.data, public.filtered_data, public.shortlived, session
      type: memory
      public.data.expire: 10
    # Celery config
    services.celery:
      celery_always_eager: true
    extract.celery:
      celery_always_eager: true
    migrate.celery:
      celery_always_eager: true
    smarter_score_batcher.celery:
      celery_always_eager: true
    edware:
      db:
        pool_size: 20
        max_overflow: 10
        cat:
          state_code: NC
          schema_name: edware_sds_1_25
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware
        dog:
          state_code: CA
          schema_name: edware_sds_1_25_dog
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware
        fish:
          state_code: VT
          schema_name: edware_sds_1_25_fish
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware
    edware_stats:
      db:
        schema_name: edware_stats
        url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware_stats
    edware_rep:
      db:
        schema_name: repmgr_edware_pg_cluster
        url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware
    extract:
      gpg.homedir: ../../edware/config/gpg
      gpg.keyserver: None
      item_level_base_dir: /opt/edware/item_level
      raw_data_base_dir: /opt/edware/raw_data
      partial_file:
        size:
          soft_limit: 300000
          average.csv: 30000
          average.xml: 30000
    migrate:
      pgpool.hostname: 'edwdbsrv4.poc.dum.edwdc.net'
      master.hostname: 'edwdbsrv1.poc.dum.edwdc.net'
      iptables.mock: True
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edmigrate
      CELERYBEAT_SCHEDULE:
        -   name: prepare-migration
            task: task.edmigrate.master.prepare_edware_data_refresh
            schedule: timedelta
            seconds: 100
        -   name: start-migration
            task: task.edmigrate.master.start_edware_data_refresh
            schedule: timedelta
            seconds: 200
    auth:
      skip.verify: False
      saml:
        idp_server_login_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/SSORedirect/metaAlias/idp
        idp_server_logout_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/IDPSloRedirect/metaAlias/idp
        issuer_name: http://localhost:6543/sp.xml
        name_qualifier: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso

    # Don't cache any static contents
    smarter.resources.static.max_age: 0
    # Always generate pdf regardless if it exists in file system
    pdf:
      always_generate: True
      health_check.job.queue: health_check
    trigger.recache.filter.file:  ../config/comparing_populations_precache_filters.json
    sftp.jail.base_path: /tmp
    sftp:
        file_stat_watch_interval: 2
        file_stat_watch_period: 10
        file_system_scan_delay: 30
        remote:
            landing_zone_hostname: localhost
    hpz:
        file_registration_url: http://edwappsrv1.poc.dum.edwdc.net:81/registration
        file_upload_base_url: http://edwappsrv1.poc.dum.edwdc.net:81/files

test:
  '[app:main]':
    cache:
      regions: public.data, public.filtered_data, public.shortlived, session
      type: memory
      public.data.expire: 10
      public.shortlived.expire: 10
    edware:
      db:
        cat:
          state_code: NC
          schema_name: edware_sds_1_25
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
        dog:
          state_code: CA
          schema_name: edware_sds_1_25_dog
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
        fish:
          state_code: VT
          schema_name: edware_sds_1_25_fish
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
    edware_stats:
      db:
        schema_name: edware_sds_1_25
        url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests_stats
    extract:
      gpg.homedir: ../../edware/config/gpg
      gpg.keyserver: None
    extract.celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/services
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.qa.dum.edwdc.net/edmigrate
    services.celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edextract
    smarter_score_batcher.celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/smarter_score_batcher
    auth:
      skip.verify: False
      saml:
        idp_server_login_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/SSORedirect/metaAlias/idp
        idp_server_logout_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/IDPSloRedirect/metaAlias/idp
        issuer_name: http://localhost:6543/sp.xml
        name_qualifier: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso
    mode: dev
    trigger.recache.filter.file:  ../config/comparing_populations_precache_filters.json
    # Celery config
    services.celery:
      celery_always_eager: true
    extract.celery:
      celery_always_eager: true
    migrate.celery:
      celery_always_eager: true
    hpz:
        file_registration_url: http://edwappsrv1.poc.dum.edwdc.net:81/registration
        file_upload_base_url: http://edwappsrv1.poc.dum.edwdc.net:81/files

integration:
  '[app:main]':
    cache:
      regions: public.data, public.filtered_data, public.shortlived, session
      type: memory
      public.data.expire: 10
      public.shortlived.expire: 10
    edware:
      db:
        cat:
          state_code: CA
          schema_name: edware
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
        dog:
          state_code: CA
          schema_name: edware
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
        fish:
          state_code: VT
          schema_name: edware
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
    edware_stats:
      db:
        schema_name: edware_stats
        url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware_stats
    extract:
      gpg.homedir: ../../edware/config/gpg
      gpg.keyserver: None
    extract.celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/services
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.qa.dum.edwdc.net/edmigrate
    services.celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edextract
    auth:
      skip.verify: False
      saml:
        idp_server_login_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/SSORedirect/metaAlias/idp
        idp_server_logout_url: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/IDPSloRedirect/metaAlias/idp
        issuer_name: http://localhost:6543/sp.xml
        name_qualifier: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso
    mode: dev
    trigger.recache.filter.file:  ../config/comparing_populations_precache_filters.json
    hpz:
        file_registration_url: http://localhost/registration
        file_upload_base_url: http://localhost/files

jenkins_int:
  '[app:main]':
    smarter.PATH: /usr/local/bin:/opt/pdfunite/bin
    services.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/services
      CELERYD_CONCURRENCY: 4
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edmigrate
    extract:
      celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edextract
        CELERYD_CONCURRENCY: 4
      gpg.homedir : /var/lib/jenkins/.gnupg
      gpg.keyserver: hkp://edwappsrv3.poc.dum.edwdc.net
    smarter_score_batcher:
      celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/smarter_score_batcher
    edware:
      db:
        cat:
          state_code: NC
          schema_name: edware_prod
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
        dog:
          state_code: CA
          schema_name: edware_prod
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
        fish:
          state_code: VT
          schema_name: edware_prod
          url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware
    edware_stats:
      db:
        schema_name: edware_stats
        url: postgresql+psycopg2://edware:edware2013@localhost:5432/edware_stats
    auth:
      policy.secure: False
      skip.verify: False
      saml:
        issuer_name: 'http://edwappsrv1.poc.dum.edwdc.net/'
        idp_server_login_url: 'http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/SSORedirect/metaAlias/idp'
        idp_server_logout_url: 'http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/IDPSloRedirect/metaAlias/idp'
        name_qualifier: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso
    mode: test
    pdf:
      report_base_dir: /opt/edware/pdf
      base.url: http://edwappsrv1.poc.dum.edwdc.net/assets/html/
      health_check.job.queue: health_check
      generate_timeout: 30
    cache:
      public.shortlived.url: edwappsrv1.poc.dum.edwdc.net:11211
      public.filtered_data.url: edwappsrv1.poc.dum.edwdc.net:11211
      public.data.url: edwappsrv1.poc.dum.edwdc.net:11211
      session.url: edwappsrv2.poc.dum.edwdc.net:11211
    pickup:
      sftp.hostname: localhost
    hpz:
        file_registration_url: http://edwappsrv1.poc.dum.edwdc.net:81/registration
        file_upload_base_url: http://edwappsrv1.poc.dum.edwdc.net:81/files

jenkins_dev:
  '[app:main]':
    smarter.PATH: /opt/pdfunite/bin/
    services.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/services
      CELERYD_CONCURRENCY: 4
    migrate.celery:
      BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edmigrate
    extract:
      celery:
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/edextract
        CELERYD_CONCURRENCY: 4
      gpg.homedir : /var/lib/jenkins/.gnupg
      gpg.keyserver: hkp://edwappsrv3.poc.dum.edwdc.net
      item_level_base_dir: /opt/edware/item_level
      raw_data_base_dir: /opt/edware/raw_data
      partial_file:
        size:
          soft_limit: 300000
          average.csv: 30000
          average.xml: 30000
    smarter_score_batcher:
      celery:
        celery_always_eager: true
        BROKER_URL: amqp://edware:edware1234@edwappsrv1.poc.dum.edwdc.net/smarter_score_batcher
    edware:
      db:
        cat:
          state_code: NC
          schema_name: edware_sds_1_25
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
        dog:
          state_code: CA
          schema_name: edware_sds_1_25_dog
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
        fish:
          state_code: VT
          schema_name: edware_sds_1_25_fish
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
    edware_stats:
      db:
        schema_name: edware_sds_1_25
        url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests_stats
    auth:
      policy.secure: False
      skip.verify: False
      saml:
        issuer_name: 'http://edwappsrv1.poc.dum.edwdc.net/'
        idp_server_login_url: 'http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/SSORedirect/metaAlias/idp'
        idp_server_logout_url: 'http://edwappsrv4.poc.dum.edwdc.net:18080/opensso/IDPSloRedirect/metaAlias/idp'
        name_qualifier: http://edwappsrv4.poc.dum.edwdc.net:18080/opensso
    mode: test
    pdf:
      report_base_dir: /opt/edware/pdf
      base.url: http://edwappsrv1.poc.dum.edwdc.net/assets/html/
      health_check.job.queue: health_check
      generate_timeout: 30
    cache:
      public.shortlived.url: edwappsrv1.poc.dum.edwdc.net:11211
      public.filtered_data.url: edwappsrv1.poc.dum.edwdc.net:11211
      public.data.url: edwappsrv1.poc.dum.edwdc.net:11211
      session.url: edwappsrv2.poc.dum.edwdc.net:11211
    pickup:
      sftp.hostname: localhost
    hpz:
        file_registration_url: http://edwappsrv1.poc.dum.edwdc.net:81/registration
        file_upload_base_url: http://edwappsrv1.poc.dum.edwdc.net:81/files

air:
  '[app:main]':
    cache:
      regions: public.data, public.filtered_data, public.shortlived, session
      type: memory
      public.data.expire: 10
    # Celery config
    services.celery:
      celery_always_eager: true
    extract.celery:
      celery_always_eager: true
    migrate.celery:
      celery_always_eager: true
    edware:
      db:
        ca:
          state_code: NC
          schema_name: edware_sds_1_2
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
        dog:
          state_code: CA
          schema_name: edware_sds_1_2_dog
          url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_functional_tests
    edware_stats:
      db:
        schema_name: edware_sds_1_2
        url: postgresql+psycopg2://edware:edware2013@edwdbsrv1.poc.dum.edwdc.net:5432/edware_stats
    auth:
      skip.verify: False
      saml:
        idp_server_login_url: http://drcamp-dev.opentestsystem.org:8080/auth/SSORedirect/metaAlias/sbac/idp
        idp_server_logout_url: http://drcamp-dev.opentestsystem.org:8080/auth/IDPSloRedirect/metaAlias/sbac/idp
        issuer_name: http://localhost:6543/sp.xml
        name_qualifier: http://drcamp-dev.opentestsystem.org:8080/auth
      idp:
        metadata: ../../resource/air_idp_metadata.xml
    # Don't cache any static contents
    smarter.resources.static.max_age: 0
    # Always generate pdf regardless if it exists in file system
    pdf:
      always_generate: True
      health_check.job.queue: health_check
    trigger.recache.filter.file:  ../config/comparing_populations_precache_filters.json
    hpz:
        file_registration_url: http://localhost/registration
        file_upload_base_url: http://localhost/files
